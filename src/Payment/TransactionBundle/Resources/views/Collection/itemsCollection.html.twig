{% extends 'PaymentApplicationBundle::layout.html.twig' %}
{% block title %}Cobros Mensuales - {{ parent() }} {% endblock %}
{% block javascripts %}
 {{ parent() }}

<script type="text/javascript">
  var link = '_deleteConsumption';
  var action_print = "{{ path('_printCollection',{'accountId': accountId }) }}";
  function submit_check()
  {	
	  var alto = 500; 
	  var ancho = 550;
	  var posicion_x; 
	  var posicion_y; 
	  posicion_x=(screen.width/2)-(ancho/2); 
	  posicion_y=(screen.height/2)-(alto/2); 
	  window.open(action_print, 'popup', "width="+ancho+",height="+alto+",menubar=0,toolbar=0,directories=0,scrollbars=no,resizable=no,left="+posicion_x+",top="+posicion_y+"");
  }
  </script>
 <script type="text/javascript" src="{{ asset('bundles/paymentapplication/js/deleteConfirmation.js') }}"></script>
{% endblock %}	

{% block content %}
<div id="title_image">Cobros Mensuales</div>
<table id="menu_sup" width="350" border="0" align="right" style="padding:5px;">
        <tr>
            <td style="text-align: center">
            <a href="javascript:if({{ accountId }}==0){alert('Por favor especifique de que cuenta desea realizar el pago');}else{if(confirm('Está seguro que desea registrar el pago presentado?')){ submit_check(); }}">
                    <div id="button_new"></div>Imprimir</a>
            </td>            
            </tr>
            </table>
    <br>    
    {% for flashMessage in app.session.flashbag.get('message') %}
    <div class="flash-message">
    {% autoescape false %}
        {{ flashMessage|trans({}, 'FOSUserBundle') }}
    {% endautoescape %}
    </div><br>
{% endfor %}

{{ app.session.flashbag.set('message', '')}}

<form action="{{ path('_itemsCollection') }}" method="post" {{ form_enctype(form) }} id='collectionSearch' name="collectionSearch">
	{{ form_errors(form) }}
                <table class="tableSearch">
                    <tr>
                    {% set required = 1 %}
                    {% include 'PaymentApplicationBundle:Finder:finder.html.twig' %}
                        <td valign="top">
                                <input type="submit" name="btsend" id="button_search" value='Buscar' />                                
                            </td>
                        </tr> 
                        <tr>
                          <td colspan="3">{{ form_errors(form.account) }}</td></tr>
                    </table>
{{ form_rest(form) }}
                </form>
  {% if (band) %}
<table>
<tr><td colspan="4"><b>Junta Administradora del Abastecimiento del Agua Potable<b></td></tr>
<tr><td colspan="4" align="center"><font size="1">Provincia de Tungurahua</font></td></tr>
<tr><td colspan="4">&nbsp;</td></tr>
<tr><td> Número de Cuenta:</td><td>{{ account.accountNumber }}</td><td> Número de Conexión:</td><td>{{ account.meterNumber }}</td></tr>
<tr><td>Nombre:</td><td colspan="3">{{ account.member.name }} {{ account.member.lastName }}</td></tr>     
<tr><td> Dirección:</td><td colspan="3">{{ account.member.address }}</td></tr>   
<tr><td> Teléfono:</td><td>{{ account.member.phone }}</td><td> Celular:</td><td>{{ account.member.celularPhone }}</td></tr>  
</table>
<br>
{% if(contItems > 0) %}

<table border="1">
<tr><th>Fecha</th><th>Motivo</th><th>Valor</th></tr>
{% set total = 0 %}
{% for item in items %}
	<tr>
	<td> {{ item.date }}</td>
	<td> {{ item.motive }}</td>
	<td> {{ item.cost | number_format(2) }} {% set total = total + item.cost %}</td>
	</tr>
{% endfor %}
<tr><td colspan="2" align="right"><b>Total</b></td><td><b>{{ total | number_format(2) }}</b></td></tr>
</table>
{% else %}
No existe consumos para esta cuenta.
{% endif %}
{% endif %}
{% endblock %}	