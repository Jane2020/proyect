{% extends 'PaymentApplicationBundle::layout.html.twig' %}
{% block javascripts %}
 {{ parent() }}
<script type="text/javascript" src="{{ asset('bundles/paymentreport/js/reportAssistance.js') }}"></script>
<script type="text/javascript">

function printService()
{
	document.getElementById("print").style.visibility='hidden' ;
	document.getElementById("print").style.position = 'absolute';
	document.getElementById("botonera").style.visibility='hidden' ;
	document.getElementById("botonera").style.position = 'absolute';
	document.getElementById("topline").style.visibility='hidden';
	document.getElementById("topline").style.position = 'absolute';
	document.getElementById("copyright").style.visibility='hidden';
	document.getElementById("copyright").style.position = 'absolute';
	document.getElementById("searchButton").style.visibility='hidden';
	document.getElementById("searchButton").style.position = 'absolute';
	document.getElementById("tableSearch").style.visibility='hidden';
	document.getElementById("tableSearch").style.position = 'absolute';
	document.getElementById("temporal").style.visibility='visible';
	document.getElementById("temporal").style.position = 'relative';
	document.getElementById("temporal").innerHTML= formString();
	if ({{ total }} > 10)
	{
		document.getElementById("paginator").style.visibility='hidden';
		document.getElementById("paginator").style.position = 'absolute';
	}
	window.print();
	document.getElementById("print").style.visibility='visible';
	document.getElementById("print").style.position = 'relative';
	document.getElementById("botonera").style.visibility='visible';
	document.getElementById("botonera").style.position = 'relative';
	document.getElementById("topline").style.visibility='visible' ;
	document.getElementById("topline").style.position = 'relative';
	document.getElementById("copyright").style.visibility='visible' ;
	document.getElementById("copyright").style.position = 'relative';
	document.getElementById("searchButton").style.visibility='visible';
	document.getElementById("searchButton").style.position = 'relative';
	document.getElementById("temporal").style.visibility='hidden';
	document.getElementById("temporal").style.position = 'absolute';
	document.getElementById("tableSearch").style.visibility='visible';
	document.getElementById("tableSearch").style.position = 'relative';
	if ({{ total }} > 10)
	{
		document.getElementById("paginator").style.visibility='visible';
		document.getElementById("paginator").style.position = 'relative';
	}			
}

function formString()
{
	name = document.getElementById("memberAssistanceSearch_name").value;
	if (!name)
	{
		name = 'Ninguno';
	}
	typePosition = document.getElementById("memberAssistanceSearch_paymentType").selectedIndex;
	type =  document.getElementById("memberAssistanceSearch_paymentType").options[typePosition].text;
	
	startDate = document.getElementById("memberAssistanceSearch_startDate").value;
	if (!startDate)
	{
		startDate = 'Ninguno';
	}
	endDate	= document.getElementById("memberAssistanceSearch_endDate").value;
	if (!endDate)
	{
		endDate = 'Ninguno';
	}
	value = '<table><tr><td><b>Nombre:</b>&nbsp;'+name+'&nbsp;&nbsp;&nbsp;&nbsp;</td><td><b>Tipo:</b>&nbsp;'+type+'&nbsp;&nbsp;&nbsp;&nbsp;</td><td><b>Fecha de Inicio:</b>&nbsp;'+startDate+'&nbsp;&nbsp;&nbsp;&nbsp;</td><td><b>Fecha de Fin:</b>&nbsp;'+endDate+'</td></tr><tr><td>&nbsp;</td><td></td><td></td><td></td></tr></table>';
	return value;
}

function clearForm()
{
	document.getElementById("memberAssistanceSearch_startDate").value = '';
	document.getElementById("memberAssistanceSearch_endDate").value = '';
	document.getElementById("memberAssistanceSearch_name").value = ''; 	
}
</script>
<link rel="stylesheet" type="text/css" href="{{ asset('bundles/paymentsecurity/css/security.css') }}" />
{% endblock %}	
{% block content %}
<div id="title_image">Reporte de Infracciones</div>
{% set action = path('reportMemberAssistance')  %}
<table width="350" border="0" align="right" style="padding:5px;" id="print">
	<tr>
	    <td style="text-align: center">
	     	<a href='javascript:printService();' >Imprimir</a>	    	
        </td>
    </tr>    
</table>
<br><br><br>
{% for flashMessage in app.session.flashbag.get('message') %}
    <div class="flash-message">
{% autoescape false %}
    {{ flashMessage|trans({}, 'FOSUserBundle') }}
{% endautoescape %}
    </div><br>
{% endfor %}
{{ app.session.flashbag.set('message', '')}}
<form action="{{ path('reportMemberAssistance') }}" method="post" {{ form_enctype(form) }} id='memberAssistanceSearch' name="memberAssistanceSearch">
	{{ form_errors(form) }}
    <table class="tableSearch" id="tableSearch" >
    	<tr>
    	    <td class="titleSearch">{{ form_label(form.name) }}</td>
    	    <td>{{ form_widget(form.name, { 'attr': {'class': 'textoBuscar' } }) }}</td>
    	    <td class="titleSearch">{{ form_label(form.paymentType) }}</td>
    	    <td colspan="2">{{ form_widget(form.paymentType) }}</td>
    	</tr>
    	<tr>    
    	    <td class="titleSearch">{{ form_label(form.startDate) }}</td>
    	    <td>{{ form_widget(form.startDate, { 'attr': {'readonly': 'readonly' } }) }}</td>
    	    <td class="titleSearch">{{ form_label(form.endDate) }}</td>
    	    <td>{{ form_widget(form.endDate, { 'attr': {'readonly': 'readonly' } }) }}</td>    	    
    	    <td valign="top">
				{{ form_widget(form.offset, { 'attr': {'value': '0'} }) }}  
				{{ form_widget(form.limit, { 'attr': {'value': limit } }) }}  
				<div id = "searchButton">
                	<input type="submit" name="btsend" id="button_search" value='Buscar' id="btsend"/>
                	<input type="button" value="Resetear" onClick="javascript:clearForm();">
                </div>
            </td>            
		</tr> 
        <tr>
        	<td colspan="3"><div class="error"></div></td>
        </tr>
        <tr>
        	<td></td><td>{{ form_errors(form.name) }}</td><td><br></td>
       	</tr>
	</table>
	<div id="temporal" style="visibility: hidden;">		
	</div>
{{ form_rest(form) }}
</form>
<div id = "print">
<form id='form_check' name='form_check' action='' method='post'>
	<table id="tableListUser" >
    	<tr>
        	<th class="title">
                Nombre del Miembro
            </th>
            <th class="title">
                Tipo de Infracci√≥n
            </th>     
            <th class="title">
               Fecha de Registro
            </th>        
    	</tr>
		{% set i = 1 %}
		{% for item in memberAssistance %}
        <tr>
 			<td class="content_table" >
				{% if (item.member) %}
					{{ item.member.name}} {{ item.member.lastname}}
			    {% endif %}	
			    {% if (item.account) %}
			    	{{ item.account.member.name}} {{ item.account.member.lastname}}			    	
				{% endif %}	
            </td> 
            <td class="content_table" >
            	{{ item.paymentType.name}} 
            </td>
            <td class="content_table" >
				{{ item.paymentDate|date('Y-m-d')}}
            </td>                                          
         </tr>
		{% set i = i +1 %}
		{% endfor %}
         <tr>
		{% if  total==0 %}
        	<td colspan="3" align="center" class="content_table_left">
            	No existen items a mostrar
            </td>
		{% endif %}
        </tr>
</table>
 {% if ((total > limit) or (limit == 9999)) %}
<table id="paginator">
	<tr>
    	<td align="center">
			{% include 'PaymentApplicationBundle:Paginator:paginatorItems.html.twig' %}
        </td>	
	</tr>
</table>
</div>
{% endif %}	
</form>
{% endblock %}